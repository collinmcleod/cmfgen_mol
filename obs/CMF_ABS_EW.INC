!
!
        T3=12.85_LDP*SQRT( TDOP/AMASS_DOP + (VTURB_FIX/12.85_LDP)**2 )
	T3=T3*FL/C_KMS
	T1=6.0_LDP*T3
	T2=3.0_LDP*FL*V(1)/C_KMS
	I=(T1+T2)/T3+1; NCF=MIN(I,NCF)
	T3=(T1+T2)/(NCF-1)
	NU(1)=FL+T1
	DO ML=2,NCF
	  NU(ML)=NU(1)-(ML-1)*T3
	END DO
!
	FQW=0.0_LDP
	DO I=1,NCF-1
	  FQW(I)=FQW(I)+0.5E+15_LDP*(NU(I)-NU(I+1))
	  FQW(I+1)=FQW(I+1)+0.5E+15_LDP*(NU(I)-NU(I+1))
	END DO
!
!	ETA_CLUMP=ETA_CLUMP+ESEC_CLUMP*RJ
!
        T1=1.0E-15_LDP/1.77245385095516_LDP         !1.0D-15/SQRT(PI)
        T2=12.85_LDP*SQRT( TDOP/AMASS_DOP + (VTURB_FIX/12.85_LDP)**2 )
        T3=FL*T2/C_KMS
	OBS=0.0_LDP
	DO ML=1,NCF
	  T4=( (NU(ML)-FL)/T3 )**2
	  IF(T4 .LT. 36.0_LDP)OBS(ML)=EXP(-T4)*T1/T3
	END DO
!
!	DO I=1,ND
!	  WRITE(155,'(I4,3ES14.5)')I,CHI(I),ESEC(I),CHI_SCAT(I)
!	END DO
!
! TX=JBAR, Z=ZNET
! OBS = PROF; J_INT=JINT
! SOB=dZdCHIL; Z=dZdETAL
! RJ=JCONT
! TA=JBLANK, TB=HBLANK
!
	J_INT=0.0_LDP
	T1=HDKT*FL/T(ND)
	EMHNUKT(ND)=EXP(-T1)
        T2=1.0_LDP-EMHNUKT(ND)
        DBB=TWOHCSQ*( FL**3 )*T1*DTDR/T(ND)*EMHNUKT(ND)/(T2**2)
!
	TC=RJ
	CALL COMP_EW_ABS_EW(ETA_CLUMP,CHI_CLUMP,CHI_SCAT_CLUMP,CHIL,ETAL,V,SIGMA,R,P,
	1                  TC,EW,ABS_EW,EW_CUT_OFF,CONT_INT,AQW,HQW,
	1                  NU,OBS,FQW,TA,FL,TRANS_NAME_SIM(1),DIF,DBB,IC,AMASS_DOP,
	1                  L_FALSE,L_FALSE,NCF,NC,NP,ND,METHOD)
!
!	ETA_CLUMP=ETA_CLUMP+CHI_SCAT_CLUMP*RJ
!	DO K=1,2
!	  CALL FORM_EW(ETA_CLUMP,CHI_CLUMP,CHI_SCAT_CLUMP,CHIL,ETAL,V,SIGMA,R,P,
!	1                  TC,Z,RJ,TA,TB,J_INT,
!	1                  EW,T1,CONT_INT,L_TRUE,L_TRUE,
!	1                  AQW,HQW,
!	1                  NU,OBS,FQW,TA,FL,DIF,DBB,IC,AMASS_DOP,
!	1                  L_FALSE,L_FALSE,NCF,NC,NP,ND,METHOD)
!	END DO
!
!	WRITE(115,'(F12.4,4ES14.4,5X,A)')0.01*C_KMS/FL,CONT_INT,FL,EW,ABS_EW,TRIM(TRANS_NAME_SIM(1))
!	FLUSH(UNIT=115)
